/**
 * @fileoverview Firestore Security Rules for the LabelSync application.
 *
 * Core Philosophy:
 * This ruleset prioritizes authorization independence and simplicity. It provides
 * basic protection against unauthorized data access and modification. The rules
 * are designed to be flexible during the prototyping phase, focusing on
 * authentication and basic ownership checks while allowing for schema evolution.
 *
 * Data Structure:
 * - /products/{productId}: Stores product information.
 * - /labels/{labelId}: Stores label information, including a productId referencing the parent product.
 * - /command_logs/{commandLogId}: Stores append-only command logs.
 * - /themes/{themeId}: Stores global theme information.
 * - /product_label_designs/{designLinkId}: Links a product and a label to a specific design.
 *
 * Key Security Decisions:
 * - Products: Currently allows anyone to read product data, but restricts writes.
 * - Labels: Currently allows anyone to read label data, but restricts writes.
 * - Command Logs: Restricts all access.  Requires future rules to allow admin-only writes.
 * - Themes: Restricts all access.  Requires future rules to allow admin-only access.
 * - Product Label Designs: Restricts all access. Requires future rules to allow admin-only writes.
 * - Denormalization: The design uses denormalization to avoid `get()` calls in security rules.
 *   Specifically, the `Label` entity contains a `productId` field, which allows
 *   ownership-based security rules without needing to fetch the `Product` document.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Grants public read access to products, but restricts writes.  Currently write access is denied to all.
     * @path /products/{productId}
     * @allow get, list: if true;
     * @deny create, update, delete: if false;
     * @principle Allows public reads, but protects against unauthorized data modification.
     */
    match /products/{productId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Grants public read access to labels, but restricts writes.  Currently write access is denied to all.
     * @path /labels/{labelId}
     * @allow get, list: if true;
     * @deny create, update, delete: if false;
     * @principle Allows public reads, but protects against unauthorized data modification.
     */
    match /labels/{labelId} {
      allow get, list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Restricts access to command logs.  Currently all access is denied.
     * @path /command_logs/{commandLogId}
     * @deny get, list, create, update, delete: if false;
     * @principle Enforces strict access control for sensitive log data.
     */
    match /command_logs/{commandLogId} {
      allow get: if false;
      allow list: if false;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Restricts access to themes.  Currently all access is denied.
     * @path /themes/{themeId}
     * @deny get, list, create, update, delete: if false;
     * @principle Enforces strict access control for theme data.
     */
    match /themes/{themeId} {
      allow get: if false;
      allow list: if false;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Restricts access to product label designs. Currently all access is denied.
     * @path /product_label_designs/{designLinkId}
     * @deny get, list, create, update, delete: if false;
     * @principle Enforces strict access control for product label design data.
     */
    match /product_label_designs/{designLinkId} {
        allow get: if false;
        allow list: if false;
        allow create: if false;
        allow update: if false;
        allow delete: if false;
    }
  }
}