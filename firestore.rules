/**
 * @file Overview
 * This ruleset enforces a basic data access model with an emphasis on ownership and admin-controlled data.
 * Data Structure:
 * - /products/{productId}: Stores product information, accessible to all for reading, but write access is restricted.
 * - /labels/{labelId}: Stores label information, accessible to all for reading, but write access is restricted.
 * - /command_logs/{commandLogId}: Stores command logs, with restricted write access.
 * - /themes/{themeId}: Stores themes, accessible to all for reading, but write access is restricted to admins.
 * - /product_label_designs/{designLinkId}: Stores the selected design for a product's label.
 *
 * Key Security Decisions:
 * - Public read access is allowed on /products, /labels, and /themes.
 * - Write access to /products, /labels, /command_logs, and /product_label_designs is restricted.  An admin role is required (unimplemented).
 * - No user listing is permitted.
 *
 * Denormalization for Authorization:
 * - The ruleset avoids `get()` calls by relying on the `productId` field within `Label` documents.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read product information, but restricts writes.
     * @path /products/{productId}
     * @allow (get, list)
     * @deny (create, update, delete)
     * @principle Allows public read access but restricts writes to prevent unauthorized modifications.
     */
    match /products/{productId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Implement admin role check
    }

    /**
     * @description Allows anyone to read label information, but restricts writes.
     * @path /labels/{labelId}
     * @allow (get, list)
     * @deny (create, update, delete)
     * @principle Allows public read access but restricts writes to prevent unauthorized modifications.
     */
    match /labels/{labelId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Implement admin role check
    }

    /**
     * @description Restricts all access to command logs.
     * @path /command_logs/{commandLogId}
     * @allow None
     * @deny (create, get, list, update, delete)
     * @principle Restricts access to command logs.
     */
    match /command_logs/{commandLogId} {
      allow get, list, create, update, delete: if false;
    }

    /**
     * @description Allows anyone to read theme information, but restricts writes to admins.
     * @path /themes/{themeId}
     * @allow (get, list)
     * @deny (create, update, delete)
     * @principle Allows public read access but restricts writes to prevent unauthorized modifications.
     */
    match /themes/{themeId} {
      allow get, list: if true;
      allow create, update, delete: if false; // TODO: Implement admin role check
    }

    /**
     * @description Allows anyone to read a product label design, but restricts writes.
     * @path /product_label_designs/{designLinkId}
     * @allow (get, list)
     * @deny (create, update, delete)
     * @principle Allows public read access but restricts writes to prevent unauthorized modifications.
     */
    match /product_label_designs/{designLinkId} {
        allow get, list: if true;
        allow create, update, delete: if false; // TODO: Implement admin role check
    }
  }
}